!function(){"use strict";var b=function(){return b=Object.assign||function(d){for(var a,b=1,e=arguments.length,c;b<e;b++)for(c in a=arguments[b])Object.prototype.hasOwnProperty.call(a,c)&&(d[c]=a[c]);return d},b.apply(this,arguments)},h,A,x,S,R,r,ap,X,ao,an,_,aj,M,ai,af,j,ab,y,H,E,I,K,o,u,$,n,ak,z,aa,g,ac,ad,ae,J,ag,ah,N,m,al,am,Z,O,P,aq,ar,q,e,v;function D(c,d,a,b){return new(a||(a=Promise))(function(g,f){function h(a){try{e(b.next(a))}catch(a){f(a)}}function i(a){try{e(b.throw(a))}catch(a){f(a)}}function e(c){var b;c.done?g(c.value):(b=c.value,b instanceof a?b:new a(function(a){a(b)})).then(h,i)}e((b=b.apply(c,d||[])).next())})}function C(g,h){var e,c,a,f,b={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return f={next:d(0),throw:d(1),return:d(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function d(d){return function(f){return function(d){if(e)throw new TypeError("Generator is already executing.");for(;b;)try{if(e=1,c&&(a=2&d[0]?c.return:d[0]?c.throw||((a=c.return)&&a.call(c),0):c.next)&&!(a=a.call(c,d[1])).done)return a;switch(c=0,a&&(d=[2&d[0],a.value]),d[0]){case 0:case 1:a=d;break;case 4:return b.label++,{value:d[1],done:!1};case 5:b.label++,c=d[1],d=[0];continue;case 7:d=b.ops.pop(),b.trys.pop();continue;default:if(!(a=b.trys,(a=a.length>0&&a[a.length-1])||6!==d[0]&&2!==d[0])){b=0;continue}if(3===d[0]&&(!a||d[1]>a[0]&&d[1]<a[3])){b.label=d[1];break}if(6===d[0]&&b.label<a[1]){b.label=a[1],a=d;break}if(a&&b.label<a[2]){b.label=a[2],b.ops.push(d);break}a[2]&&b.ops.pop(),b.trys.pop();continue}d=h.call(g,b)}catch(a){d=[6,a],c=0}finally{e=a=0}if(5&d[0])throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}([d,f])}}}function k(d,b,e){if(e||2===arguments.length)for(var c,a=0,f=b.length;a<f;a++)!c&&a in b||(c||(c=Array.prototype.slice.call(b,0,a)),c[a]=b[a]);return d.concat(c||Array.prototype.slice.call(b))}function c(b){let c=!!globalThis.window;return!c&&b&&a().warn(b),c}function B(a){if(!c())throw new Error(a||"window' is not available. Seems like this code runs outside browser environment. It shouldn't happen");return window}h={DEBUG:{name:"DEBUG",severity:10},INFO:{name:"INFO",severity:100},WARN:{name:"WARN",severity:1e3},ERROR:{name:"ERROR",severity:1e4},NONE:{name:"NONE",severity:1e4}},A=null;function a(){return A||(A=Y())}function Y(e){var f=c()&&window.__eventNLogLevel,a=h.WARN,b,d;return f?(b=h[f.toUpperCase()],b&&b>0&&(a=b)):e&&(a=e),d={minLogLevel:a},Object.values(h).forEach(function(c){var b=c.name,e=c.severity;d[b.toLowerCase()]=function(){for(var c=[],d=0,h,f,g;d<arguments.length;d++)c[d]=arguments[d];e>=a.severity&&c.length>0&&(h=c[0],f=c.splice(1),g="[J-".concat(b,"] ").concat(h),"DEBUG"===b||"INFO"===b?console.log.apply(console,k([g],f,!1)):"WARN"===b?console.warn.apply(console,k([g],f,!1)):console.error.apply(console,k([g],f,!1)))}}),function(b,d){if(c()){var a=window;a.__usermavenDebug||(a.__usermavenDebug={}),a.__usermavenDebug[b]=d}}("logger",d),d}function aw(d,e,a){var c,b;if(void 0===a&&(a={}),b=d+"="+encodeURIComponent(e),b+="; Path="+(null!==(c=a.path)&&void 0!==c?c:"/"),a.maxAge&&(b+="; Max-Age="+Math.floor(a.maxAge)),a.domain&&(b+="; Domain="+a.domain),a.expires&&(b+="; Expires="+a.expires.toUTCString()),a.httpOnly&&(b+="; HttpOnly"),a.secure&&(b+="; Secure"),a.sameSite)switch("string"==typeof a.sameSite?a.sameSite.toLowerCase():a.sameSite){case!0:b+="; SameSite=Strict";break;case"lax":b+="; SameSite=Lax";break;case"strict":b+="; SameSite=Strict";break;case"none":b+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return b}function av(f){var d,e,a,c,b;if(!f)return{};for(d={},e=f.split(";"),a=0;a<e.length;a++)c=e[a],b=c.indexOf("="),b>0&&(d[c.substr(a>0?1:0,a>0?b-1:b)]=c.substr(b+1));return d}function au(a,b){return Array.from(a.attributes).forEach(function(a){b.setAttribute(a.nodeName,a.nodeValue)})}function at(e,f){var a,b,d,c;e.innerHTML=f,b=e.getElementsByTagName("script");for(a=b.length-1;a>=0;a--)d=b[a],c=document.createElement("script"),au(d,c),d.innerHTML&&(c.innerHTML=d.innerHTML),c.setAttribute("data-usermaven-tag-id",e.id),document.getElementsByTagName("head")[0].appendChild(c),b[a].parentNode.removeChild(b[a])}S=function(a){return a&&decodeURIComponent(B().document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},R=function(b,c,a){void 0===a&&(a={}),B().document.cookie=aw(b,c,a)},r=function(b,a){void 0===a&&(a="/"),document.cookie=b+"= ; expires = Thu, 01 Jan 1970 00:00:00 GMT"+(a?"; path = "+a:"")},ap=function(){return Math.random().toString(36).substring(2,12)},X=function(){return Math.random().toString(36).substring(2,7)},ao={utm_source:"source",utm_medium:"medium",utm_campaign:"campaign",utm_term:"term",utm_content:"content"},an={gclid:!0,fbclid:!0,dclid:!0},_=function(){function a(){this.queue=[]}return a.prototype.flush=function(){var a=this.queue;return this.queue=[],a},a.prototype.push=function(){for(var b,c=[],a=0;a<arguments.length;a++)c[a]=arguments[a];(b=this.queue).push.apply(b,c)},a}(),aj=function(){function a(a){this.key=a}return a.prototype.flush=function(){var a=this.get();return a.length&&this.set([]),a},a.prototype.push=function(){for(var c=[],a=0,b;a<arguments.length;a++)c[a]=arguments[a];b=this.get(),b.push.apply(b,c),this.set(b)},a.prototype.set=function(a){localStorage.setItem(this.key,JSON.stringify(a))},a.prototype.get=function(){var a=localStorage.getItem(this.key);return null!==a&&""!==a?JSON.parse(a):[]},a}(),M=Object.prototype,ai=M.toString,af=M.hasOwnProperty,j=Array.prototype.forEach,ab=Array.isArray,y={},H=ab||function(a){return"[object Array]"===ai.call(a)};function G(a,c,d){if(Array.isArray(a))if(j&&a.forEach===j)a.forEach(c,d);else if("length"in a&&a.length===+a.length)for(var b=0,e=a.length;b<e;b++)if(b in a&&c.call(d,a[b],b)===y)return}E=function(a){return a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function d(a,d,e){var b,f,c;if(null!=a)if(j&&Array.isArray(a)&&a.forEach===j)a.forEach(d,e);else if("length"in a&&a.length===+a.length){for(b=0,f=a.length;b<f;b++)if(b in a&&d.call(e,a[b],b)===y)return}else for(c in a)if(af.call(a,c)&&d.call(e,a[c],c)===y)return}I=function(b){for(var c=[],a=1;a<arguments.length;a++)c[a-1]=arguments[a];return G(c,function(a){for(var c in a)void 0!==a[c]&&(b[c]=a[c])}),b};function i(a,b){return-1!==a.indexOf(b)}K=function(a){try{return/^\s*\bfunction\b/.test(a)}catch(a){return!1}},o=function(a){return void 0===a},u=function(){function b(a){return a&&(a.preventDefault=b.preventDefault,a.stopPropagation=b.stopPropagation),a}return b.preventDefault=function(){this.returnValue=!1},b.stopPropagation=function(){this.cancelBubble=!0},function(c,d,e,g,h){if(c)if(c.addEventListener&&!g)c.addEventListener(d,e,!!h);else{var f="on"+d,i=c[f];c[f]=function(c,d,a){return function(e){var f,g,h;if(e=e||b(window.event))return g=!0,K(a)&&(f=a(e)),h=d.call(c,e),!1!==f&&!1!==h||(g=!1),g}}(c,e,i)}else a().error("No valid element provided to register_event")}}(),$=function(b){return function(){for(var d=[],c=0;c<arguments.length;c++)d[c]=arguments[c];try{return b.apply(this,d)}catch(b){a().error("Implementation error. Please turn on debug and contact support@usermaven.com.",b)}}},n="undefined"!=typeof Symbol?Symbol("__deepCircularCopyInProgress__"):"__deepCircularCopyInProgress__";function s(a,c,e){return a!==Object(a)?c?c(a,e):a:a[n]?void 0:(a[n]=!0,H(a)?(b=[],G(a,function(a){b.push(s(a,c))})):(b={},d(a,function(d,a){a!==n&&(b[a]=s(d,c,a))})),delete a[n],b);var b}ak=["$performance_raw"];function ax(b,a){return s(b,function(b,c){return c&&ak.indexOf(c)>-1?b:"string"==typeof b&&null!==a?b.slice(0,a):b})}function p(a){switch(typeof a.className){case"string":return a.className;case"object":return("baseVal"in a.className?a.className.baseVal:null)||a.getAttribute("class")||"";default:return""}}function T(a){var b="";return F(a)&&!Q(a)&&a.childNodes&&a.childNodes.length&&d(a.childNodes,function(a){W(a)&&a.textContent&&(b+=E(a.textContent).split(/(\s+)/).filter(l).join("").replace(/[\r\n]/g," ").replace(/[ ]+/g," ").substring(0,255))}),E(b)}function U(a){return!!a&&1===a.nodeType}function f(a,b){return!!a&&!!a.tagName&&a.tagName.toLowerCase()===b.toLowerCase()}function W(a){return!!a&&3===a.nodeType}function L(a){return!!a&&11===a.nodeType}z=["a","button","form","input","select","textarea","label"];function F(a){for(var b=a,c,d,e;b.parentNode&&!f(b,"body");b=b.parentNode)if(c=p(b).split(" "),i(c,"ph-sensitive")||i(c,"ph-no-capture"))return!1;if(i(p(a).split(" "),"ph-include"))return!0;if(d=a.type||"","string"==typeof d)switch(d.toLowerCase()){case"hidden":case"password":return!1}if(e=a.name||a.id||"","string"==typeof e)if(/^cc|cardnum|ccnum|creditcard|csc|cvc|cvv|exp|pass|pwd|routing|seccode|securitycode|securitynum|socialsec|socsec|ssn/i.test(e.replace(/[^a-zA-Z0-9]/g,"")))return!1;return!0}function Q(a){return!!(f(a,"input")&&!["button","checkbox","submit","reset"].includes(a.type)||f(a,"select")||f(a,"textarea")||"true"===a.getAttribute("contenteditable"))}function l(a){if(null===a||o(a))return!1;if("string"==typeof a){if(a=E(a),/^(?:(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11}))$/.test((a||"").replace(/[- ]/g,"")))return!1;if(/(^\d{3}-?\d{2}-?\d{4}$)/.test(a))return!1}return!0}aa=function(){function a(b,a){void 0===a&&(a=!1),this.clicks=[],this.instance=b,this.enabled=a}return a.prototype.click=function(b,c,d){if(this.enabled){var a=this.clicks[this.clicks.length-1];a&&Math.abs(b-a.x)+Math.abs(c-a.y)<30&&d-a.timestamp<1e3?(this.clicks.push({x:b,y:c,timestamp:d}),3===this.clicks.length&&this.instance.capture("$rageclick")):this.clicks=[{x:b,y:c,timestamp:d}]}},a}(),g={_initializedTokens:[],_previousElementSibling:function(b){if(b.previousElementSibling)return b.previousElementSibling;var a=b;do a=a.previousSibling;while(a&&!U(a))return a},_getPropertiesFromElement:function(a,i,j){var f=a.tagName.toLowerCase(),b={tag_name:f},g,h,e,c;z.indexOf(f)>-1&&!j&&(b.$el_text=T(a)),g=p(a),g.length>0&&(b.classes=g.split(" ").filter(function(a){return""!==a})),d(a.attributes,function(c){var d;Q(a)&&-1===["name","id","class"].indexOf(c.name)||!i&&l(c.value)&&("string"!=typeof(d=c.name)||"_ngcontent"!==d.substring(0,10)&&"_nghost"!==d.substring(0,7))&&(b["attr__"+c.name]=c.value)});for(h=1,e=1,c=a;c=this._previousElementSibling(c);)h++,c.tagName===a.tagName&&e++;return b.nth_child=h,b.nth_of_type=e,b},_getDefaultProperties:function(a){return{$event_type:a,$ce_version:1}},_extractCustomPropertyValue:function(b){var a=[];return d(document.querySelectorAll(b.css_selector),function(b){var c;["input","select"].indexOf(b.tagName.toLowerCase())>-1?c=b.value:b.textContent&&(c=b.textContent),l(c)&&a.push(c)}),a.join(", ")},_getCustomProperties:function(b){var c=this,a={};return d(this._customProperties,function(e){d(e.event_selectors,function(f){d(document.querySelectorAll(f),function(d){i(b,d)&&F(d)&&(a[e.name]=c._extractCustomPropertyValue(e))})})}),a},_getEventTarget:function(a){var b;return void 0===a.target?a.srcElement||null:(null===(b=a.target)||void 0===b?void 0:b.shadowRoot)?a.composedPath()[0]||null:a.target||null},_captureEvent:function(c,n,e){var k,o=this,b=this._getEventTarget(c),j,a,g,h,m,q;if(W(b)&&(b=b.parentNode||null),"click"===c.type&&c instanceof MouseEvent&&(null===(k=this.rageclicks)||void 0===k||k.click(c.clientX,c.clientY,(new Date).getTime())),b&&function(b,c){var e,g,d,a,h,i,j;if(!b||f(b,"html")||!U(b))return!1;for(e=!1,g=[b],d=!0,a=b;a.parentNode&&!f(a,"body");)if(L(a.parentNode))g.push(a.parentNode.host),a=a.parentNode.host;else{if(!(d=a.parentNode||!1))break;z.indexOf(d.tagName.toLowerCase())>-1?e=!0:(h=window.getComputedStyle(d),h&&"pointer"===h.getPropertyValue("cursor")&&(e=!0)),g.push(d),a=d}if(i=window.getComputedStyle(b),i&&"pointer"===i.getPropertyValue("cursor")&&"click"===c.type)return!0;switch(j=b.tagName.toLowerCase(),j){case"html":return!1;case"form":return"submit"===c.type;case"input":case"select":case"textarea":return"change"===c.type||"click"===c.type;default:return e?"click"===c.type:"click"===c.type&&(z.indexOf(j)>-1||"true"===b.getAttribute("contenteditable"))}}(b,c)){for(j=[b],a=b;a.parentNode&&!f(a,"body");)L(a.parentNode)?(j.push(a.parentNode.host),a=a.parentNode.host):(j.push(a.parentNode),a=a.parentNode);return!(h=[],m=!1,d(j,function(a){var b=F(a);"a"===a.tagName.toLowerCase()&&(g=a.getAttribute("href"),g=b&&l(g)&&g),i(p(a).split(" "),"ph-no-capture")&&(m=!0),h.push(o._getPropertiesFromElement(a,null==e?void 0:e.mask_all_element_attributes,null==e?void 0:e.mask_all_text))}),(null==e?void 0:e.mask_all_text)||(h[0].$el_text=T(b)),g&&(h[0].attr__href=g),m)&&(q=I(this._getDefaultProperties(c.type),{$elements:h},this._getCustomProperties(j)),n.capture("$autocapture",q),!0)}},_navigate:function(a){window.location.href=a},_addDomEventHandlers:function(b,c){var d=this,a=function(a){a=a||window.event,d._captureEvent(a,b,c)};u(document,"submit",a,!1,!0),u(document,"change",a,!1,!0),u(document,"click",a,!1,!0)},_customProperties:[],rageclicks:null,opts:{},init:function(a,b){var c=this;if(this.rageclicks=new aa(a),this.opts=b,!document||!document.body)return console.debug("document not ready yet, trying again in 500 milliseconds..."),void setTimeout(function(){c.readyAutocapture(a,b)},500);this.readyAutocapture(a,b)},readyAutocapture:function(a,b){this._addDomEventHandlers(a,b)},enabledForProject:function(c,a,b){if(!c)return!0;a=o(a)?10:a,b=o(b)?10:b;for(var e=0,d=0;d<c.length;d++)e+=c.charCodeAt(d);return e%a<b},isBrowserSupported:function(){return K(document.querySelectorAll)}},!function(a){for(var b in a)"function"==typeof a[b]&&(a[b]=a[b].bind(a))}(g),function(a){for(var b in a)"function"==typeof a[b]&&(a[b]=$(a[b]))}(g),ac="__buildEnv__",ad="__buildDate__",ae="".concat("__buildVersion__","/").concat(ac,"@").concat(ad),J=316224e3,ag=function(c,b){a().debug("Sending beacon",b);var d=new Blob([b],{type:"text/plain"});return navigator.sendBeacon(c,d),Promise.resolve()},ah=function(a,b){return console.debug("Jitsu client tried to send payload to ".concat(a),function(a){if("string"==typeof a)try{return JSON.stringify(JSON.parse(a),null,2)}catch(b){return a}}(b)),Promise.resolve()};function t(b,a){void 0===a&&(a=void 0),""!=(a=null!=a?a:window.location.pathname)&&"/"!=a&&(r(b,a),t(b,a.slice(0,a.lastIndexOf("/"))))}N=function(){function b(a,b){this.cookieDomain=a,this.cookieName=b}return b.prototype.save=function(a){R(this.cookieName,JSON.stringify(a),{domain:this.cookieDomain,secure:"http:"!==document.location.protocol,maxAge:J})},b.prototype.restore=function(){var c,b;if(t(this.cookieName),c=S(this.cookieName),c)try{return b=JSON.parse(decodeURIComponent(c)),"object"!=typeof b?void a().warn("Can't restore value of ".concat(this.cookieName,"@").concat(this.cookieDomain,", expected to be object, but found ").concat("object"!=typeof b,": ").concat(b,". Ignoring")):b}catch(b){return void a().error("Failed to decode JSON from "+c,b)}},b.prototype.delete=function(){r(this.cookieName)},b}(),m=function(){function a(){}return a.prototype.save=function(a){},a.prototype.restore=function(){},a.prototype.delete=function(){},a}(),al={getSourceIp:function(){},describeClient:function(){return{referer:document.referrer,url:window.location.href,page_title:document.title,doc_path:document.location.pathname,doc_host:document.location.hostname,doc_search:window.location.search,screen_resolution:screen.width+"x"+screen.height,vp_size:Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)+"x"+Math.max(document.documentElement.clientHeight||0,window.innerHeight||0),user_agent:navigator.userAgent,user_language:navigator.language,doc_encoding:document.characterSet}},getAnonymousId:function(e){var b=e.name,f=e.domain,c,d;return t(b),c=S(b),c?(a().debug("Existing user id",c),c):(d=ap(),a().debug("New user id",d),R(b,d,{domain:f,secure:"http:"!==document.location.protocol,maxAge:J}),d)}},am={getSourceIp:function(){},describeClient:function(){return{}},getAnonymousId:function(){return""}},Z=function(){return al},O=function(){return am},P=function(e,d,f,c){void 0===c&&(c=function(a,b){});var b=new window.XMLHttpRequest;return new Promise(function(h,g){b.onerror=function(b){a().error("Failed to send",d,b),c(-1,{}),g(new Error("Failed to send JSON. See console logs"))},b.onload=function(){200!==b.status?(c(b.status,{}),a().warn("Failed to send data to ".concat(e," (#").concat(b.status," - ").concat(b.statusText,")"),d),g(new Error("Failed to send JSON. Error code: ".concat(b.status,". See logs for details")))):c(b.status,b.responseText),h()},b.open("POST",e),b.setRequestHeader("Content-Type","application/json"),Object.entries(f||{}).forEach(function(a){var c=a[0],d=a[1];return b.setRequestHeader(c,d)}),b.send(d),a().debug("sending json",d)})},aq=function(){function e(){this.userProperties={},this.permanentProperties={globalProps:{},propsPerEvent:{}},this.cookieDomain="",this.trackingHost="",this.idCookieName="",this.randomizeUrl=!1,this.apiKey="",this.initialized=!1,this._3pCookies={},this.cookiePolicy="keep",this.ipPolicy="keep",this.beaconApi=!1,this.transport=P,this.customHeaders=function(){return{}},this.queue=new _,this.maxSendAttempts=4,this.retryTimeout=[500,1e12],this.flushing=!1,this.attempt=1,this.propertyBlacklist=[],this.__autocapture_enabled=!1}return e.prototype.get_config=function(a){return this.config?this.config[a]:null},e.prototype.id=function(c,d){return this.userProperties=b(b({},this.userProperties),c),a().debug("Usermaven user identified",c),this.userIdPersistence?this.userIdPersistence.save(c):a().warn("Id() is called before initialization"),d?Promise.resolve():this.track("user_identify",{})},e.prototype.rawTrack=function(a){return this.sendJson(a)},e.prototype.makeEvent=function(f,l,i){var e,a=i.env,k=function(b,e){var d={},a,c;for(a in b)Object.prototype.hasOwnProperty.call(b,a)&&e.indexOf(a)<0&&(d[a]=b[a]);if(null!=b&&"function"==typeof Object.getOwnPropertySymbols){c=0;for(a=Object.getOwnPropertySymbols(b);c<a.length;c++)e.indexOf(a[c])<0&&Object.prototype.propertyIsEnumerable.call(b,a[c])&&(d[a[c]]=b[a[c]])}return d}(i,["env"]),h,g,d,j;return a||(a=c()?Z():O()),this.restoreId(),h=this.getCtx(a),g=b(b({},this.permanentProperties.globalProps),null!==(e=this.permanentProperties.propsPerEvent[f])&&void 0!==e?e:{}),d=b({api_key:this.apiKey,src:l,event_type:f},k),j=a.getSourceIp(),j&&(d.source_ip=j),this.compatMode?b(b(b({},g),{eventn_ctx:h}),d):b(b(b({},g),h),d)},e.prototype._send3p=function(c,d,a){var b="3rdparty",e;return a&&""!==a&&(b=a),e=this.makeEvent(b,c,{src_payload:d}),this.sendJson(e)},e.prototype.sendJson=function(a){return D(this,void 0,Promise,function(){return C(this,function(b){switch(b.label){case 0:return this.maxSendAttempts>1?(this.queue.push([a,0]),this.scheduleFlush(0),[3,3]):[3,1];case 1:return[4,this.doSendJson(a)];case 2:b.sent(),b.label=3;case 3:return[2]}})})},e.prototype.doSendJson=function(i){var g=this,e="keep"!==this.cookiePolicy?"&cookie_policy=".concat(this.cookiePolicy):"",f="keep"!==this.ipPolicy?"&ip_policy=".concat(this.ipPolicy):"",h=c()?"/api/v1/event":"/api/v1/s2s/event",b="".concat(this.trackingHost).concat(h,"?token=").concat(this.apiKey).concat(e).concat(f),d;return this.randomizeUrl&&(b="".concat(this.trackingHost,"/api.").concat(X(),"?p_").concat(X(),"=").concat(this.apiKey).concat(e).concat(f)),d=JSON.stringify(i),a().debug("Sending payload to ".concat(b),d),this.transport(b,d,this.customHeaders(),function(a,b){return g.postHandle(a,b)})},e.prototype.scheduleFlush=function(b){var c=this,d,e;this.flushing||(this.flushing=!0,void 0===b&&(d=Math.random()+1,e=Math.pow(2,this.attempt++),b=Math.min(this.retryTimeout[0]*d*e,this.retryTimeout[1])),a().debug("Scheduling event queue flush in ".concat(b," ms.")),setTimeout(function(){return c.flush()},b))},e.prototype.flush=function(){return D(this,void 0,Promise,function(){var b,d,e=this;return C(this,function(f){switch(f.label){case 0:if(c()&&!window.navigator.onLine&&(this.flushing=!1,this.scheduleFlush()),b=this.queue.flush(),this.flushing=!1,0===b.length)return[2];f.label=1;case 1:return f.trys.push([1,3,,4]),[4,this.doSendJson(b.map(function(a){return a[0]}))];case 2:return f.sent(),this.attempt=1,a().debug("Successfully flushed ".concat(b.length," events from queue")),[3,4];case 3:return f.sent(),(b=b.map(function(a){return[a[0],a[1]+1]}).filter(function(b){return!(b[1]>=e.maxSendAttempts)||(a().error("Dropping queued event after ".concat(b[1]," attempts since max send attempts ").concat(e.maxSendAttempts," reached. See logs for details")),!1)})).length>0?((d=this.queue).push.apply(d,b),this.scheduleFlush()):this.attempt=1,[3,4];case 4:return[2]}})})},e.prototype.postHandle=function(j,b){var d,g,h,i,f,k,l,m,e;if("strict"===this.cookiePolicy||"comply"===this.cookiePolicy){if(200===j)if(d=b,"string"==typeof b&&(d=JSON.parse(b)),!d.delete_cookie)return;this.userIdPersistence.delete(),this.propsPersistance.delete(),r(this.idCookieName)}if(200===j)if(d=b,"string"==typeof b&&b.length>0)if(g=(d=JSON.parse(b)).jitsu_sdk_extras,g&&g.length>0)if(c()){for(h=0,i=g;h<i.length;h++)f=i[h],k=f.type,l=f.id,m=f.value,"tag"===k&&(e=document.createElement("div"),e.id=l,at(e,m),e.childElementCount>0&&document.body.appendChild(e))}else a().error("Tags destination supported only in browser environment")},e.prototype.getCtx=function(d){var e=new Date,f=d.describeClient()||{},g=this.userProperties.company||{},a,c,h;return delete this.userProperties.company,h=b(b({event_id:"",user:b({anonymous_id:"strict"!==this.cookiePolicy?d.getAnonymousId({name:this.idCookieName,domain:this.cookieDomain}):""},this.userProperties),ids:this._getIds(),utc_time:(a=e.toISOString(),c=a.split(".")[1],c?c.length>=7?a:a.slice(0,-1)+"0".repeat(7-c.length)+"Z":a),local_tz_offset:e.getTimezoneOffset()},f),function(b){var c={utm:{},click_id:{}},a,d,e;for(a in b)b.hasOwnProperty(a)&&(d=b[a],e=ao[a],e?c.utm[e]=d:an[a]&&(c.click_id[a]=d));return c}(function(a){var b,d,e,c,f;if(!a)return{};for(b=a.length>0&&"?"===a.charAt(0)?a.substring(1):a,d={},e=("?"===b[0]?b.substr(1):b).split("&"),c=0;c<e.length;c++)f=e[c].split("="),d[decodeURIComponent(f[0])]=decodeURIComponent(f[1]||"");return d}(f.doc_search))),Object.keys(g).length&&(h.company=g),h},e.prototype._getIds=function(){var g,d,b,e,f,a,h;if(!c())return{};for(g=function(a){if(void 0===a&&(a=!1),a&&x)return x;var b=av(document.cookie);return x=b,b}(!1),d={},b=0,e=Object.entries(g);b<e.length;b++)f=e[b],a=f[0],h=f[1],this._3pCookies[a]&&(d["_"==a.charAt(0)?a.substr(1):a]=h);return d},e.prototype.pathMatches=function(a,b){return new URL(b).pathname.match(new RegExp("^"+a.trim().replace(/\*\*/g,".*").replace(/([^\.])\*/g,"$1[^\\s/]*")+"/?$"))},e.prototype.track=function(d,e){var f=this,g=e||{},h,b,i;return a().debug("track event of type",d,g),h=c()?Z():O(),b=this.getCtx(h),this.config&&this.config.exclude&&this.config.exclude.length>1&&(null==b?void 0:b.url)&&this.config.exclude.split(",").some(function(a){return f.pathMatches(a.trim(),null==b?void 0:b.url)})?void a().debug("Page is excluded from tracking"):(i=this.makeEvent(d,this.compatMode?"eventn":"usermaven",e||{}),this.sendJson(i))},e.prototype.init=function(d){var f,g,l,i,n,j,k,o=this,e;if(c()&&!d.force_use_fetch)d.fetch&&a().warn("Custom fetch implementation is provided to Usermaven. However, it will be ignored since Usermaven runs in browser"),this.transport=this.beaconApi?ag:P;else{if(!d.fetch&&!globalThis.fetch)throw new Error("Usermaven runs in Node environment. However, neither UsermavenOptions.fetch is provided, nor global fetch function is defined. \nPlease, provide custom fetch implementation. You can get it via node-fetch package");this.transport=(n=d.fetch||globalThis.fetch,function(d,e,f,c){return void 0===c&&(c=function(a,b){}),D(void 0,void 0,void 0,function(){var g,o,j,h,k,m,l,i;return C(this,function(p){switch(p.label){case 0:return p.trys.push([0,2,,3]),[4,n(d,{method:"POST",headers:b({Accept:"application/json","Content-Type":"application/json"},f||{}),body:e})];case 1:return g=p.sent(),[3,3];case 2:return o=p.sent(),a().error("Failed to send",e,o),c(-1,{}),[2];case 3:if(200!==g.status)return a().warn("Failed to send data to ".concat(d," (#").concat(g.status," - ").concat(g.statusText,")"),e),c(g.status,{}),[2];j={},h="",k=null!==(i=null===(l=g.headers)||void 0===l?void 0:l.get("Content-Type"))&&void 0!==i?i:"",p.label=4;case 4:return p.trys.push([4,6,,7]),[4,g.text()];case 5:return h=p.sent(),j=JSON.parse(h),[3,7];case 6:return m=p.sent(),a().error("Failed to parse ".concat(d," response. Content-type: ").concat(k," text: ").concat(h),m),[3,7];case 7:try{c(g.status,j)}catch(b){a().error("Failed to handle ".concat(d," response. Content-type: ").concat(k," text: ").concat(h),b)}return[2]}})})})}d.custom_headers&&"function"==typeof d.custom_headers?this.customHeaders=d.custom_headers:d.custom_headers&&(this.customHeaders=function(){return d.custom_headers}),"echo"===d.tracking_host&&(a().warn('jitsuClient is configured with "echo" transport. Outgoing requests will be written to console'),this.transport=ah),d.ip_policy&&(this.ipPolicy=d.ip_policy),d.cookie_policy&&(this.cookiePolicy=d.cookie_policy),"strict"===d.privacy_policy&&(this.ipPolicy="strict",this.cookiePolicy="strict"),d.use_beacon_api&&navigator.sendBeacon&&(this.beaconApi=!0),"comply"===this.cookiePolicy&&this.beaconApi&&(this.cookiePolicy="strict"),d.log_level&&(j=d.log_level,(k=h[j.toLocaleUpperCase()])||(console.warn("Can't find log level with name ".concat(j.toLocaleUpperCase(),", defaulting to INFO")),k=h.INFO),A=Y(k)),this.initialOptions=d,a().debug("Initializing Usemaven Tracker tracker",d,ae),d.key?(this.compatMode=void 0!==d.compat_mode&&!!d.compat_mode,this.cookieDomain=d.cookie_domain||function(){if(c())return".".concat((e=location.hostname,b=function(a){return(a.indexOf("//")>-1?a.split("/")[2]:a.split("/")[0]).split(":")[0].split("?")[0]}(e),a=b.split("."),(d=a.length)>2&&(b=a[d-2]+"."+a[d-1],2==a[d-2].length&&2==a[d-1].length&&(b=a[d-3]+"."+b)),b));var e,b,a,d}(),this.trackingHost=function(a){for(;b="/",-1!==(c=a).indexOf(b,c.length-b.length);)a=a.substr(0,a.length-1);var c,b;return 0===a.indexOf("https://")||0===a.indexOf("http://")?a:"//"+a}(d.tracking_host||"t.usermaven.com"),this.randomizeUrl=d.randomize_url||!1,this.idCookieName=d.cookie_name||"__eventn_id",this.apiKey=d.key,"strict"===this.cookiePolicy?this.propsPersistance=new m:this.propsPersistance=c()?new N(this.cookieDomain,this.idCookieName+"_props"):new m,"strict"===this.cookiePolicy?this.userIdPersistence=new m:this.userIdPersistence=c()?new N(this.cookieDomain,this.idCookieName+"_usr"):new m,this.propsPersistance&&(e=this.propsPersistance.restore(),e&&(this.permanentProperties=e,this.permanentProperties.globalProps=null!==(f=e.globalProps)&&void 0!==f?f:{},this.permanentProperties.propsPerEvent=null!==(g=e.propsPerEvent)&&void 0!==g?g:{}),a().debug("Restored persistent properties",this.permanentProperties)),this.propertyBlacklist=d.property_blacklist&&d.property_blacklist.length>0?d.property_blacklist:[],this.config=I({},{autocapture:!1,properties_string_max_length:null,property_blacklist:[],sanitize_properties:null},d||{},this.config||{},{token:this.apiKey}),a().debug("Default Configuration",this.config),this.manageAutoCapture(this.config),!1===d.capture_3rd_party_cookies?this._3pCookies={}:(d.capture_3rd_party_cookies||["_ga","_fbp","_ym_uid","ajs_user_id","ajs_anonymous_id"]).forEach(function(a){return o._3pCookies[a]=!0}),d.ga_hook&&a().warn("GA event interceptor isn't supported anymore"),d.segment_hook&&function(b){var a=window;a.analytics||(a.analytics=[]),b.interceptAnalytics(a.analytics)}(this),c()&&(d.disable_event_persistence||(this.queue=new aj("jitsu-event-queue"),this.scheduleFlush(0)),window.addEventListener("beforeunload",function(){return o.flush()})),this.retryTimeout=[null!==(l=d.min_send_timeout)&&void 0!==l?l:this.retryTimeout[0],null!==(i=d.max_send_timeout)&&void 0!==i?i:this.retryTimeout[1]],d.max_send_attempts&&(this.maxSendAttempts=d.max_send_attempts),this.initialized=!0):a().error("Can't initialize Usemaven, key property is not set")},e.prototype.interceptAnalytics=function(c){var e=this,d=function(d){var g,c,h,f,i;try{c=b({},d.payload),a().debug("Intercepted segment payload",c.obj),h=d.integrations["Segment.io"],h&&h.analytics&&(f=h.analytics,"function"==typeof f.user&&f.user()&&"function"==typeof f.user().id&&(c.obj.userId=f.user().id())),(null===(g=null==c?void 0:c.obj)||void 0===g?void 0:g.timestamp)&&(c.obj.sentAt=c.obj.timestamp),i=d.payload.type(),"track"===i&&(i=d.payload.event()),e._send3p("ajs",c,i)}catch(b){a().warn("Failed to send an event",b)}d.next(d.payload)};"function"==typeof c.addSourceMiddleware?(a().debug("Analytics.js is initialized, calling addSourceMiddleware"),c.addSourceMiddleware(d)):(a().debug("Analytics.js is not initialized, pushing addSourceMiddleware to callstack"),c.push(["addSourceMiddleware",d])),c.__en_intercepted=!0},e.prototype.restoreId=function(){if(this.userIdPersistence){var a=this.userIdPersistence.restore();a&&(this.userProperties=b(b({},a),this.userProperties))}},e.prototype.set=function(e,a){var c,d=null==a?void 0:a.eventType,f=void 0===(null==a?void 0:a.persist)||(null==a?void 0:a.persist),g;void 0!==d?(g=null!==(c=this.permanentProperties.propsPerEvent[d])&&void 0!==c?c:{},this.permanentProperties.propsPerEvent[d]=b(b({},g),e)):this.permanentProperties.globalProps=b(b({},this.permanentProperties.globalProps),e),this.propsPersistance&&f&&this.propsPersistance.save(this.permanentProperties)},e.prototype.unset=function(c,a){B();var b=null==a?void 0:a.eventType,d=void 0===(null==a?void 0:a.persist)||(null==a?void 0:a.persist);b?this.permanentProperties.propsPerEvent[b]&&delete this.permanentProperties.propsPerEvent[b][c]:delete this.permanentProperties.globalProps[c],this.propsPersistance&&d&&this.propsPersistance.save(this.permanentProperties)},e.prototype.manageAutoCapture=function(b){a().debug("Auto Capture Status: ",this.config.autocapture),this.__autocapture_enabled=this.config.autocapture,this.__autocapture_enabled&&(g.enabledForProject(this.apiKey,100,100)?g.isBrowserSupported()?(a().debug("Autocapture enabled..."),g.init(this,b)):(this.config.autocapture=!1,this.__autocapture_enabled=!1,a().debug("Disabling Automatic Event Collection because this browser is not supported")):(this.config.autocapture=!1,this.__autocapture_enabled=!1,a().debug("Not in active bucket: disabling Automatic Event Collection.")))},e.prototype.capture=function(b,a){var c,d,e;void 0===a&&(a={}),this.initialized?o(b)||"string"!=typeof b?console.error("No event name provided to usermaven.capture"):(e={event:b+(a.$event_type?"_"+a.$event_type:""),properties:this._calculate_event_properties(b,a)},(null===(d=null===(c=(e=ax(e,this.get_config("properties_string_max_length"))).properties)||void 0===c?void 0:c.autocapture_attributes)||void 0===d?void 0:d.tag_name)&&this.track("$autocapture",e.properties)):console.error("Trying to capture event before initialization")},e.prototype._calculate_event_properties=function(h,g){var b,c,a=g||{},f,e;return"$snapshot"===h?a:(H(this.propertyBlacklist)?d(this.propertyBlacklist,function(b){delete a[b]}):console.error("Invalid value for property_blacklist config: "+this.propertyBlacklist),f={},e=a.$elements||[],e.length&&(f=e[0]),a.autocapture_attributes=f,a.autocapture_attributes.el_text=null!==(b=a.autocapture_attributes.$el_text)&&void 0!==b?b:"",a.autocapture_attributes.event_type=null!==(c=a.$event_type)&&void 0!==c?c:"",["$ce_version","$event_type","$initial_referrer","$initial_referring_domain","$referrer","$referring_domain","$elements"].forEach(function(b){delete a[b]}),delete a.autocapture_attributes.$el_text,delete a.autocapture_attributes.nth_child,delete a.autocapture_attributes.nth_of_type,a)},e}(),ar=["use_beacon_api","cookie_domain","tracking_host","cookie_name","key","ga_hook","segment_hook","randomize_url","capture_3rd_party_cookies","id_method","log_level","compat_mode","privacy_policy","cookie_policy","ip_policy","custom_headers","force_use_fetch","min_send_timeout","max_send_timeout","max_send_attempts","disable_event_persistence","project_id","autocapture","properties_string_max_length","property_blacklist","exclude"],q="data-suppress-interception-warning";function V(a){return"\n      ATTENTION! ".concat(a,"-hook set to true along with defer/async attribute! If ").concat(a," code is inserted right after Usermaven tag,\n      first tracking call might not be intercepted! Consider one of the following:\n       - Inject usermaven tracking code without defer/async attribute\n       - If you're sure that events won't be sent to ").concat(a," before Usermaven is fully initialized, set ").concat(q,'="true"\n       script attribute\n    ')}function w(b,f){var c,d,g,h,e;a().debug("Processing queue",b);for(c=0;c<b.length;c+=1)d=k([],b[c],!0)||[],g=d[0],h=d.slice(1),e=f[g],"function"==typeof e&&e.apply(f,h);b.length=0}window?(e=window,v=function(c){var b=document.currentScript||document.querySelector("script[src*=jsFileName][data-usermaven-api-key]"),f,d,e;if(b)return d={tracking_host:(f=b.getAttribute("src"),f.replace("/s/lib.js","").replace("/lib.js","")),key:null},ar.forEach(function(e){var c="data-"+e.replace(new RegExp("_","g"),"-"),a;void 0!==b.getAttribute(c)&&null!==b.getAttribute(c)&&(a=b.getAttribute(c),"true"===a?a=!0:"false"===a&&(a=!1),d[e]=a)}),c.usermavenClient=function(b){var a=new aq;return a.init(b),a}(d),!d.segment_hook||null===b.getAttribute("defer")&&null===b.getAttribute("async")||null!==b.getAttribute(q)||a().warn(V("segment")),!d.ga_hook||null===b.getAttribute("defer")&&null===b.getAttribute("async")||null!==b.getAttribute(q)||a().warn(V("ga")),e=function(){var a=c.usermavenQ=c.usermavenQ||[];a.push(arguments),w(a,c.usermavenClient)},c.usermaven=e,d.project_id&&e("set",{project_id:d.project_id}),"true"!==b.getAttribute("data-init-only")&&"yes"!==b.getAttribute("data-init-only")&&e("track","pageview"),c.usermavenClient;a().warn("Usermaven script is not properly initialized. The definition must contain data-usermaven-api-key as a parameter")}(e),v?(a().debug("Usermaven in-browser tracker has been initialized"),e.usermaven=function(){var a=e.usermavenQ=e.usermavenQ||[];a.push(arguments),w(a,v)},e.usermavenQ&&(a().debug("Initial queue size of ".concat(e.usermavenQ.length," will be processed")),w(e.usermavenQ,v))):a().error("Usermaven tracker has not been initialized (reason unknown)")):a().warn("Usermaven tracker called outside browser context. It will be ignored")}()